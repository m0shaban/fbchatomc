"""
Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ± - Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©
ÙŠÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø²ÙˆØ§Ø± ØµÙØ­Ø© Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ± Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ
Ø³ÙˆØ§Ø¡ Ø¹Ø¨Ø± Ø§Ù„Ù…Ø§Ø³Ù†Ø¬Ø± Ø£Ùˆ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª
"""

import json
import re
import os
import random
import logging
import datetime
from typing import Dict, List, Tuple, Optional, Any
from api import DeepSeekAPI
from config import BOT_SETTINGS, APP_SETTINGS

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
logging.basicConfig(
    level=getattr(logging, APP_SETTINGS["LOG_LEVEL"]),
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    filename=BOT_SETTINGS.get("LOG_FILE")
)
logger = logging.getLogger(__name__)

class ChatBot:
    """
    Ø´Ø§Øª Ø¨ÙˆØª Ø°ÙƒÙŠ Ù„Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø²ÙˆØ§Ø± ØµÙØ­Ø© Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ± Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ
    Ø³ÙˆØ§Ø¡ Ø¹Ø¨Ø± Ø§Ù„Ù…Ø§Ø³Ù†Ø¬Ø± Ø£Ùˆ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª
    """
    
    def __init__(self, data_file: str = None, api_key: Optional[str] = None):
        """
        ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù JSON
        
        :param data_file: Ù…Ø³Ø§Ø± Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ØµÙŠØºØ© JSON
        :param api_key: Ù…ÙØªØ§Ø­ API Ù„Ø®Ø¯Ù…Ø© DeepSeek (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        """
        self.bot_name = "Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©"  # Ø§Ø³Ù… Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª
        self.data_file = data_file or BOT_SETTINGS.get("DATA_FILE", "data.json")
        self.prompts = []
        self.human_expressions = {}
        self.contact_info = {}
        self.requires_human_contact = []
        self.user_categories = []
        self.job_sectors = []
        self.personalize_response = BOT_SETTINGS.get("PERSONALIZE_RESPONSE", True)
        self.similarity_threshold = BOT_SETTINGS.get("SIMILARITY_THRESHOLD", 0.4)
        
        # Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·
        self.service_links = {}
        self.service_categories = {}
        
        # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù JSON
        self.load_data()
        
        # ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ø¬Ù‡Ø© API
        self.api = DeepSeekAPI(api_key)
        
        # ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙŠØªØ¶Ù…Ù† Ø§Ù„Ø¢Ù† Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        self.conversation_history = {}
        
        # Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        self.conversation_state = {}
        
        # ØªØ¹ÙŠÙŠÙ† Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠ
        self.conversation_source = "messenger"  # messenger Ø£Ùˆ facebook_comment

        # Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        self.continue_conversation = BOT_SETTINGS.get("CONTINUE_CONVERSATION", True)
        self.continue_phrases = [
            "Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ù…Ø²ÙŠØ¯Ø§Ù‹ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§ØªØŸ",
            "Ù‡Ù„ Ù„Ø¯ÙŠÙƒ Ø£Ø³Ø¦Ù„Ø© Ø£Ø®Ø±Ù‰ØŸ",
            "Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ØŸ",
            "Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŸ",
            "Ù‡Ù„ Ø£Ø³ØªØ·ÙŠØ¹ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ Ø´ÙŠØ¡ Ø¢Ø®Ø±ØŸ"
        ]
        
        # Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©)
        self.customer_service_phrases = [
            "Ù„Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù…Ø¹ Ù…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø£Ø±Ø³Ù„ ÙƒÙ„Ù…Ø© 'Ù…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡'",
            "Ø¥Ø°Ø§ ÙƒÙ†Øª ØªØ±ØºØ¨ ÙÙŠ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ø£Ø­Ø¯ Ù…Ù…Ø«Ù„ÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø£Ø±Ø³Ù„ 'ØªØ­Ø¯Ø« Ù…Ø¹ Ù…Ù…Ø«Ù„'",
            "Ù„Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø£Ø±Ø³Ù„ 'Ø§ØªØµØ§Ù„ Ø¨Ù…Ù…Ø«Ù„'"
        ]
        
        # ÙˆÙ‚Øª Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ù…Ø«Ù„ Ø§Ù„Ø¨Ø´Ø±ÙŠ (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ)
        self.human_rep_wait_time = 90
        
        # Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ù…Ø«Ù„ Ø§Ù„Ø¨Ø´Ø±ÙŠ (Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©)
        self.human_rep_contact_info = {
            "name": "Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©",
            "title": "Ù…Ø¯ÙŠØ± Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±",
            "phone": "+201234567890",  # Ø±Ù‚Ù… Ø§ÙØªØ±Ø§Ø¶ÙŠØŒ ÙŠØ¬Ø¨ ØªØºÙŠÙŠØ±Ù‡
            "email": "muhammad.salama@omalmisr.com",  # Ø¨Ø±ÙŠØ¯ Ø§ÙØªØ±Ø§Ø¶ÙŠØŒ ÙŠØ¬Ø¨ ØªØºÙŠÙŠØ±Ù‡
            "whatsapp": "https://wa.me/201234567890",  # Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨ Ø§ÙØªØ±Ø§Ø¶ÙŠØŒ ÙŠØ¬Ø¨ ØªØºÙŠÙŠØ±Ù‡
            "messenger": "https://m.me/Omal.Misr.Foundation"
        }
        
        # ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© Ù„Ù„ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ Ù…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        self.customer_service_keywords = [
            "Ù…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡", "ØªØ­Ø¯Ø« Ù…Ø¹ Ù…Ù…Ø«Ù„", "Ø§ØªØµØ§Ù„ Ø¨Ù…Ù…Ø«Ù„", "ØªÙˆØµÙŠÙ„ Ø¨Ø´Ø®Øµ Ø­Ù‚ÙŠÙ‚ÙŠ", 
            "Ø´Ø®Øµ Ø­Ù‚ÙŠÙ‚ÙŠ", "ØªØ­ÙˆÙŠÙ„", "Ø§Ù†Ø³Ø§Ù†", "Ù…ÙˆØ¸Ù", "Ù…ØªØ§Ø¨Ø¹Ø©", "Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©", "Ø³Ù„Ø§Ù…Ø©",
            "Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡", "Ù…Ù†Ø¯ÙˆØ¨", "Ù…Ø³Ø§Ø¹Ø¯Ø© Ø´Ø®ØµÙŠØ©"
        ]
        
        # Ø£Ø³Ø¦Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        self.name_questions = [
            "Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©ØŒ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±. Ù…Ø§ Ù‡Ùˆ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…ØŸ",
            "Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø© Ù…Ù† Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±. Ù‚Ø¨Ù„ Ø£Ù† Ù†Ø¨Ø¯Ø£ØŒ Ù…Ù…ÙƒÙ† Ø£Ø¹Ø±Ù Ø§Ø³Ù… Ø­Ø¶Ø±ØªÙƒØŸ",
            "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…! Ù…Ø¹Ùƒ Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø© Ù…Ù† Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±. ÙŠØ´Ø±ÙÙ†ÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ….",
            "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±! Ø£Ù†Ø§ Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø© Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø´Ø®ØµÙŠ. Ù…Ø§ Ù‡Ùˆ Ø§Ø³Ù…ÙƒØŸ"
        ]
        
        # ØªØ¹Ø±ÙŠÙ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø®Ø¯Ù…Ø§Øª
        self.main_menu = {
            "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„": {
                "title": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„",
                "description": "Ø³Ø¬Ù„ Ù…Ø¹Ù†Ø§ Ù„ØªØ¬Ø¯ ÙˆØ¸ÙŠÙØªÙƒ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø©",
                "link": "https://omalmisrservices.com/ar/jobs"
            },
            "Ø£Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ¹Ù…Ø§Ù„": {
                "title": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸ÙÙŠÙ† Ùˆ Ø¹Ù…Ø§Ù„",
                "description": "Ø³Ø¬Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆØ¸ÙÙŠÙŠÙ†",
                "link": "https://omalmisrservices.com/ar/workers"
            },
            "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª": {
                "title": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
                "description": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø³Ø«Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ Ùˆ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ",
                "link": "https://omalmisrservices.com/ar/companies",
                "submenu": {
                    "Ø·Ø±Ø­ Ø§Ù„ÙØ±Øµ Ø§Ù„Ø¥Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©": {
                        "title": "Ø·Ø±Ø­ Ø§Ù„ÙØ±Øµ Ø§Ù„Ø¥Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©",
                        "description": "ÙŠØ®ØªØµ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø·Ø±Ø­ Ø§Ù„ÙØ±Øµ Ø§Ø§Ù„Ø³ØªØ«Ù…Ø§Ø±ÙŠØ© Ø§Ù„Ù…Ù…ÙŠØ²Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ Ùˆ Ø§Ù„Ù…Ø¬Ø§Ù„ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø¯Ø±Ø§Ø³Ø© Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ø­Ø§Ù„ÙŠ",
                        "link": "https://omalmisrservices.com/ar/companies/formView?type=1&media_id=2&title=%D8%B7%D8%B1%D8%AD%20%D8%A7%D9%84%D9%81%D8%B1%D8%B5%20%D8%A7%D9%84%D8%A5%D8%B3%D8%AA%D8%AB%D9%85%D8%A7%D8%B1%D9%8A%D8%A9"
                    },
                    "Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ‰ Ø§Ù„Ø¥Ù‚ØªØµØ§Ø¯ÙŠØ©": {
                        "title": "Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ‰ Ø§Ù„Ø¥Ù‚ØªØµØ§Ø¯ÙŠØ©",
                        "description": "ØªØ£ØªÙŠ Ù…Ù‡Ù…Ø© Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙÙŠ Ø¹Ù…Ù„ Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ù„Ø²Ù…Ø© Ù„Ù„Ù…Ø´Ø±ÙˆØ¹ ÙˆÙŠØ®Ø¯Ù… ØªØ­Øª Ù…Ø¸Ù„Ø© Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¹Ø¯Ø¯ 6 Ø´Ø±ÙƒØ§Øª Ù…Ø­Ù„ÙŠØ© ÙˆØ¯ÙˆÙ„ÙŠØ© Ù…ØªØ®ØµØµØ© ÙÙŠ Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ‰ Ù„Ù„Ù…Ø´Ø±ÙˆØ¹Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© ÙˆØ§Ù„ÙƒØ¨ÙŠØ±Ø©",
                        "link": "https://omalmisrservices.com/ar/companies/formView?type=1&media_id=3&title=%D8%AF%D8%B1%D8%A7%D8%B3%D8%A7%D8%AA%20%D8%A7%D9%84%D8%AC%D8%AF%D9%88%D9%89%20%D8%A7%D9%84%D8%A5%D8%AF%D8%A7%D8%B1%D9%8A%D8%A9"
                    },
                    "Ø§Ù„Ø´Ø±Ø§ÙƒØ© Ø§Ù„Ø¥Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©": {
                        "title": "Ø§Ù„Ø´Ø±Ø§ÙƒØ© Ø§Ù„Ø¥Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©",
                        "description": "ØªØªÙƒÙˆÙ† Ù…Ù‡Ù…Ø© Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙÙŠ Ø¹Ù…Ù„ Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„Ø§Ù„Ø²Ù…Ø© Ø¥Ù„Ù‚Ø§Ù…Ø© Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø¥Ù…Ø§ Ù…Ù† Ø®Ø§Ù„Ù„ ØªÙˆÙÙŠØ± Ø´Ø±ÙŠÙƒ Ù…Ø­Ù„ÙŠ Ø§Ùˆ Ø´Ø±ÙŠÙƒ Ø§Ø¬Ù†Ø¨ÙŠ ÙˆØ£ÙŠØ¶Ø§ Ù…Ù† Ø®Ø§Ù„Ù„ Ø§Ù„Ù…Ø­Ø§ÙØ¸ ÙˆØ§Ù„ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø§Ø¥Ù„Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©",
                        "link": "https://omalmisrservices.com/ar/companies/formView?type=1&media_id=4&title=%D8%A7%D9%84%D8%B4%D8%B1%D8%A7%D9%83%D8%A9%20%D8%A7%D9%84%D8%A5%D8%B3%D8%AA%D8%B1%D8%A7%D8%AA%D9%8A%D8%AC%D9%8A%D8%A9"
                    },
                    "Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡Ø§Øª ÙˆØ§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©": {
                        "title": "Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡Ø§Øª ÙˆØ§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©",
                        "description": "ÙŠØ®ØªØµ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø¹Ù…Ù„ Ø§Ù„Ø±Ø³ÙˆÙ…Ø§Øª ÙˆØ§Ù„ØªØµÙ…ÙŠÙ…Ø§Øª Ø§Ù„Ù‡Ù†Ø¯Ø³ÙŠØ© Ù„Ù„Ù…Ù†Ø´Ø£Ø© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ø¨Ù…Ø§ ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø¥Ø­ØªÙŠØ§Ø¬Ø§Øª ÙˆØ¨ÙŠØ¦Ø© Ø§Ù„Ø¹Ù…Ù„ ÙˆØªÙˆÙÙŠØ± Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø§Ù„Ø²Ù…Ø© Ø¥Ù„Ù‚Ø§Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ùˆ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©",
                        "link": "https://omalmisrservices.com/ar/companies/formView?type=1&media_id=5&title=%D8%A7%D9%84%D8%A5%D9%86%D8%B4%D8%A7%D8%A1%D8%A7%D8%AA%20%D9%88%D8%A7%D9%84%D8%B9%D9%82%D8%A7%D8%B1%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B5%D9%86%D8%A7%D8%B9%D9%8A%D8%A9"
                    },
                    "Ø§Ù„Ø®Ø§Ù…Ø§Øª ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬": {
                        "title": "Ø§Ù„Ø®Ø§Ù…Ø§Øª ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬",
                        "description": "Ø®ØªØµ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨ØªÙˆÙÙŠØ± Ø§Ù„Ø®Ø§Ù…Ø§Øª ÙˆÙ…Ø³ØªÙ„Ø²Ù…Ø§Øª Ø§Ø¥Ù„Ù†ØªØ§Ø¬ Ø·Ø¨Ù‚Ù‹ Ø§Ù„Ø§Ù„Ø²Ù…Ø© Ø¨Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ùˆ Ø§Ù„Ù…ÙˆØ§ØµÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø§ Ù„Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©",
                        "link": "https://omalmisrservices.com/ar/companies/formView?type=1&media_id=6&title=%D8%A7%D9%84%D8%AE%D8%A7%D9%85%D8%A7%D8%AA%20%D9%88%D9%85%D8%B3%D8%AA%D9%84%D8%B2%D9%85%D8%A7%D8%AA%20%D8%A7%D9%84%D8%A5%D9%86%D8%AA%D8%A7%D8%AC"
                    },
                    "Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª": {
                        "title": "Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ù…Ø­Ù„ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ùˆ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©",
                        "description": "ÙŠØ®ØªØµ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ù„Ù„Ø³ÙˆÙ‚ ØªÙ…Ù‡ÙŠØ¯Ø§ Ù„Ø¯Ø®ÙˆÙ„ Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚ ÙˆØ¨Ù†Ø§Ø¡ ÙˆØ®Ù„Ù‚ Ø§Ù„Ø§ÙÙƒØ§Ø± Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ© Ù„Ø§Ø³ØªÙ‡Ø¯Ø§Ù Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ Ù…Ù† Ø®Ù„Ø§Ù„ ÙƒØ§ÙØ© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¯Ø¹Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø®Ø·Ø· Ø§Ù„ØªØ³ÙˆÙ‚ÙŠØ© ÙˆØªØ±ÙˆÙŠØ¬ Ø§Ù„Ù…Ù†ØªØ¬ Ø·Ø¨Ø§ Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø§Ø³ÙˆØ§Ù‚ Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ø§Ù„Ù…Ø­Ù„ÙŠØ©",
                        "link": "https://omalmisrservices.com/ar/companies/formView?type=1&media_id=7&title=%D8%A7%D9%84%D8%AA%D8%B3%D9%88%D9%8A%D9%82%20%D8%A7%D9%84%D9%85%D8%AD%D9%84%D9%8A%20%D9%84%D9%84%D9%85%D9%86%D8%AA%D8%AC%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B5%D9%86%D8%A7%D8%B9%D9%8A%D8%A9%20%D9%88%20%D8%A7%D9%84%D8%B2%D8%B1%D8%A7%D8%B9%D9%8A%D8%A9"
                    },
                    "Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª": {
                        "title": "Ø§Ù„ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ø¯ÙˆÙ„ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ùˆ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©",
                        "description": "ÙŠØ®ØªØµ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø¨Ø¥Ø¬Ø±Ø§Ø¡ ØªØ­Ù„ÙŠÙ„ Ù„Ù„Ø³ÙˆÙ‚ ØªÙ…Ù‡ÙŠØ¯Ø§ Ù„ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ùˆ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ© ÙÙŠ Ø¯ÙˆÙ„ Ø§Ù„Ø®Ù„ÙŠØ¬ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ùˆ Ø¯ÙˆÙ„ Ø§ÙØ±ÙŠÙ‚ÙŠØ§ Ùˆ Ø¯ÙˆÙ„ Ø§Ø§Ù„ØªØ­Ø§Ø¯ Ø§Ø§Ù„ÙˆØ±ÙˆØ¨ÙŠ ÙˆØ¨Ù†Ø§Ø¡ ÙˆØ®Ù„Ù‚ Ø§Ø£Ù„ÙÙƒØ§Ø± Ø§Ù„ØªØ³ÙˆÙŠÙ‚ÙŠØ© Ø¥Ù„Ø³ØªÙ‡Ø¯Ø§Ù Ø§Ù„Ù…Ø³ØªÙ‡Ù„Ùƒ Ù…Ù† Ø®Ø§Ù„Ù„ ÙƒØ§ÙØ© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¯Ø¹Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø®Ø·Ø·",
                        "link": "https://omalmisrservices.com/ar/companies/formView?type=1&media_id=8&title=%D8%A7%D9%84%D8%AA%D8%B3%D9%88%D9%8A%D9%82%20%D8%A7%D9%84%D8%AF%D9%88%D9%84%D9%8A%20%D9%84%D9%84%D9%85%D9%86%D8%AA%D8%AC%D8%A7%D8%AA%20%D8%A7%D9%84%D8%B5%D9%86%D8%A7%D8%B9%D9%8A%D8%A9%20%D9%88%20%D8%A7%D9%84%D8%B2%D8%B1%D8%A7%D8%B9%D9%8A%D8%A9"
                    },
                    "Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©": {
                        "title": "Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©",
                        "description": "Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… ÙŠØ®ØªØµ Ø¨ÙˆØ¶Ø¹ Ø­Ù„ÙˆÙ„ Ù„ÙƒØ§ÙØ© Ø§Ù„Ø¹Ù‚Ø¨Ø§Øª Ù„Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ† ÙÙŠ Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ ÙˆÙÙ‚Ø§ Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ø¥Ù„Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„Ø¯ÙˆÙ„ÙŠØ© ÙˆØ§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆØªÙˆÙÙŠØ± ÙƒØ§ÙØ© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªØ­ØªØ§Ø¬Ù‡Ø§ Ø§Ù„Ù…Ù†Ø´Ø¢Øª Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© Ù…Ù† Ø§Ù„ÙˆØ²Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©.",
                        "link": "https://omalmisrservices.com/ar/companies/formView?type=1&media_id=9&title=%D8%A7%D9%84%D8%AE%D8%AF%D9%85%D8%A7%D8%AA%20%D8%A7%D9%84%D8%AD%D9%83%D9%88%D9%85%D9%8A%D8%A9"
                    },
                    "Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ": {
                        "title": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ",
                        "description": "ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¯Ø±ÙŠØ¨Ø© Ù„Ù„ÙƒÙˆØ§Ø¯Ø± Ø§Ù„Ø¨Ø´Ø±ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ© ÙˆØ§Ù„Ø§Ø¯Ø§Ø±ÙŠØ© ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„ÙÙ†ÙŠØ© ÙˆØ§Ù„Ø§Ø¯Ø§Ø±ÙŠØ©",
                        "link": "https://omalmisrservices.com/ar/companies?type=7"
                    },
                    "Ø®Ø¯Ù…Ø© Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…Ø§Ù„ÙŠØ©": {
                        "title": "Ø®Ø¯Ù…Ø© Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ù…Ø§Ù„ÙŠØ©",
                        "description": "ØªÙ‚Ø¯ÙŠÙ… Ø®Ø¯Ù…Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø¦ÙˆÙ† Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ù…Ù†Ø´Ø¢Øª ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ",
                        "link": "https://omalmisrservices.com/ar/companies?type=8"
                    },
                    "Ø®Ø¯Ù…Ø© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª": {
                        "title": "Ø®Ø¯Ù…Ø© ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª",
                        "description": "ÙŠÙ‚Ø¯Ù… Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø®Ø¯Ù…Ø§Øª Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© ÙˆØ§Ù„ØªØ·Ø¨ÙŠÙ‚Ø§Øª  Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø§Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©",
                        "link": "https://omalmisrservices.com/ar/companies?type=6"
                    },
                    "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©": {
                        "title": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©",
                        "description": "Ù‡Ùˆ Ù‚Ø·Ø§Ø¹ Ù…Ø³Ø¦ÙˆÙ„ Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø´Ø±ÙƒØ§Øª (Ø§Ù„Ø¹Ù‚ÙˆØ¯ ÙˆØ§Ù„ØªØ±Ø§Ø®ÙŠØµ-Ø¥Ø¯Ø§Ø±Ø©",
                        "link": "https://omalmisrservices.com/ar/companies?type=5"
                    },
                    "Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø¹Ù„Ø§Ù…ÙŠØ©": {
                        "title": "Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø¹Ù„Ø§Ù…ÙŠØ©",
                        "description": "ÙŠÙˆÙØ± Ø§Ù„Ø£ÙÙƒØ§Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© ÙˆØ§Ù„Ø­Ù…Ù„Ø§Øª Ø§Ù„Ø¯Ø¹Ø§Ø¦ÙŠØ© ÙˆÙŠÙˆÙØ± Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¬Ø±Ø§ÙÙŠÙƒ ÙˆØ§Ù„Ù…ÙˆÙ†ØªØ§Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ Ù…Ø¯ÙŠØ§",
                        "link": "https://omalmisrservices.com/ar/companies?type=4"
                    },
                    "Ø®Ø¯Ù…Ø§Øª ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©": {
                        "title": "Ø®Ø¯Ù…Ø§Øª ØªØ³ÙˆÙŠÙ‚ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©",
                        "description": "ÙŠØ®ØªØµ Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø¨ØªÙˆÙÙŠØ± Ø§Ù„ÙƒÙˆØ§Ø¯Ø± Ø§Ù„Ø¨Ø´Ø±ÙŠØ© Ø§Ù„Ù…Ø¯Ø±Ø¨Ø© ÙˆØ§Ù„Ù…Ø¤Ù‡Ù„Ø© (Ø§Ù„ÙÙ†ÙŠØ© ÙˆØ§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©)",
                        "link": "https://omalmisrservices.com/ar/companies?type=3"
                    },
                    "Ø®Ø¯Ù…Ø§Øª ØªØ³ÙˆÙŠÙ‚ ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„": {
                        "title": "Ø®Ø¯Ù…Ø§Øª ØªØ³ÙˆÙŠÙ‚ ÙØ±Øµ Ø§Ù„Ø¹Ù…Ù„",
                        "description": "Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø·Ø§Ø¹ ÙŠØ®ØªØµ ÙÙŠ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ùˆ ØªØ´ØºÙŠÙ„Ù‡Ù…  Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø§ÙŠÙŠØ±",
                        "link": "https://omalmisrservices.com/ar/companies?type=2"
                    },
                    "Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ ÙˆØ§Ù„Ø²Ø±Ø§Ø¹ÙŠ": {
                        "title": "Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø³ØªØ«Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ ÙˆØ§Ù„Ø²Ø±Ø§Ø¹ÙŠ",
                        "description": "ÙŠØªÙ… ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ© Ø¹Ù„Ù‰ Ø«Ù„Ø§Ø« Ù…Ø±Ø§Ø­Ù„: Ø§Ù„Ø§ÙˆÙ„Ù‰ : Ø·Ø±Ø­ Ø§Ù„ÙØ±Øµ ÙˆØ§Ù„Ø§Ù†Ø´Ø§Ø¡",
                        "link": "https://omalmisrservices.com/ar/companies?type=1"
                    }
                }
            },
            "Ø¨ÙˆØ§Ø¨Ø© ÙØ¶ Ø§Ù„Ù…Ù†Ø§Ø²Ø¹Ø§Øª": {
                "title": "Ø¨ÙˆØ§Ø¨Ø© ÙØ¶ Ùˆ ØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø²Ø§Ø¹Ø§Øª",
                "description": "Ù‡ÙŠ Ø¨ÙˆØ§Ø¨Ø© Ø¥Ù„ÙƒØªØ±Ù†ÙŠØ© Ù„ÙØ¶ Ùˆ ØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø²Ø§Ø¹Ø§Øª Ø§Ù„Ù†Ø§ØªØ¬ÙŠØ© Ø¨ÙŠÙ† Ù…Ø¤Ø³Ø³ØªÙŠÙ† Ø£Ùˆ Ø£ÙƒØ«Ø± Ø£Ùˆ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¤Ø³Ø³Ø§Øª Ùˆ Ø§Ù„Ø¹Ø§Ù…Ù„ÙŠÙ† Ø¨Ù‡Ø§ Ø¨ÙˆØ³Ø·Ø© Ø®Ø¨Ø±Ø§Ø¡ Ùˆ Ù…Ø³ØªØ´Ø§Ø±ÙŠÙ† Ù‚Ø§Ù†ÙˆÙ†ÙŠÙ† Ù…ØªØ®ØµØµÙŠÙ† Ø¯ÙˆÙ† Ø§Ù„Ù„Ø¬ÙˆØ¡ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù‚Ø¶Ø§Ø¦ÙŠØ© Ùˆ Ù‡ÙŠ ØªØªØ¨Ø¹ Ù…Ø¤Ø³Ø³Ø© Ø¹Ù…Ø§Ù„ Ù…ØµØ±",
                "link": "https://omalmisrservices.com/ar/dispute",
                "submenu": {
                    "Ù†Ø²Ø§Ø¹ Ø§Ù„Ù…Ù†Ø´Ø£Øª": {
                        "title": "Ù†Ø²Ø§Ø¹ Ø§Ù„Ù…Ù†Ø´Ø£Øª",
                        "description": "Ø®Ø¯Ù…Ø© ÙØ¶ Ø§Ù„Ù…Ù†Ø§Ø²Ø¹Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ù…Ù†Ø´Ø¢Øª",
                        "link": "https://omalmisrservices.com/ar/dispute/facility"
                    },
                    "Ù†Ø²Ø§Ø¹ Ø§Ù„Ø¹Ù…Ø§Ù„": {
                        "title": "Ù†Ø²Ø§Ø¹ Ø§Ù„Ø¹Ù…Ø§Ù„",
                        "description": "Ø®Ø¯Ù…Ø© ÙØ¶ Ø§Ù„Ù…Ù†Ø§Ø²Ø¹Ø§Øª Ø¨ÙŠÙ† Ø§Ù„Ø¹Ù…Ø§Ù„ ÙˆØ§Ù„Ù…Ù†Ø´Ø¢Øª",
                        "link": "https://omalmisrservices.com/ar/dispute/worker"
                    }
                }
            },
            "Ù…Ù† Ù†Ø­Ù†": {
                "title": "Ù…Ù† Ù†Ø­Ù†",
                "description": "Ø§Ù„Ø±ÙŠØ§Ø¯Ø© ÙÙŠ ØµÙ†Ø§Ø¹Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¹Ø§Ù„Ù…ÙŠÙ‹Ø§ Ù„Ù„Ø³ÙˆÙ‚ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ Ù…Ù† Ø®Ø§Ù„ ØªÙˆØ­ÙŠØ¯ Ø¨Ø§Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø© Ù„Ù„Ù…Ø³ØªØ«Ù…Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø­Ø¯Ø« Ø§Ù„Ø£Ø³Ø§Ù„ÙŠØ¨ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ© ÙˆÙÙ‚Ù‹Ø§ Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© ÙˆÙ†Ø´Ø± Ø§Ù„ÙˆØ¹ÙŠ Ø¨Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© ÙˆØ£Ù‡Ù…ÙŠØªÙ‡Ø§ ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ù…Ø¹ Ø§Ù„ØªÙ…Ø³Ùƒ Ø¨Ø¹Ù‚ÙŠØ¯Ø© Ø¹Ù…Ù„ Ù…Ø¤Ø³Ø³Ø© ÙˆØ§Ù„Ù†Ù‡ÙˆØ¶ Ø¨Ø£Ø¹Ø¶Ø§Ø¦Ù‡Ø§ ÙˆÙ…Ø³ØªØ«Ù…Ø±ÙŠÙ‡Ø§.",
                "link": "https://www.omalmisr.com/about",
                "submenu": {
                    "Ø±Ø¤ÙŠØªÙ†Ø§": {
                        "title": "Ø±Ø¤ÙŠØªÙ†Ø§",
                        "description": "Ù†Ø¹Ù…Ù„ Ø¨Ø±Ø¤ÙŠØ© Ù…Ø³ØªØ¯Ø§Ù…Ø© Ø­ØªÙŠ ØªØµØ¨Ø­ Ù…Ù†Ø¸ÙˆÙ…Ø© Ø¹Ù…Ø§Ù„ Ù…ØµØ± ÙƒÙŠØ§Ù† Ø®Ø¯Ù…ÙŠ ØµÙ†Ø§Ø¹ÙŠ ØªØ¹Ù„ÙŠÙ…Ù‰ Ø²Ø±Ø§Ø¹Ù‰ ÙŠØ¤Ø«Ø± ÙÙ‰ Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø§Ù‚ØªØµØ§Ø¯ Ø§Ù„Ø¯ÙˆÙ„Ù‰ ÙˆØ£Ù† ØªÙ‚ÙˆØ¯ Ø¹Ù…Ø§Ù„ Ù…ØµØ± Ø£ÙƒØ¨Ø± ØªÙƒØªÙ„ ØµÙ†Ø§Ø¹Ù‰ ÙˆÙ…Ø­ÙØ¸Ø© Ø¥Ø³ØªØ«Ù…Ø§Ø±ÙŠØ© ØµÙ†Ø§Ø¹ÙŠØ© Ù‡ÙŠ Ø§Ù„Ø§ÙˆÙ„Ù‰ Ù…Ù† Ù†ÙˆØ¹Ù‡Ø§ Ø¥ÙØ±ÙŠÙ‚ÙŠØ§ ÙˆØ¹",
                        "link": "https://www.omalmisr.com/about"
                    },
                    "Ø±Ø³Ø§Ù„ØªÙ†Ø§": {
                        "title": "Ø§Ù„Ø±Ø³Ø§Ù„Ø©",
                        "description": "Ø§Ù„Ø±ÙŠØ§Ø¯Ø© ÙÙŠ ØµÙ†Ø§Ø¹Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆØ¹Ø§Ù„Ù…ÙŠÙ‹Ø§ Ù„Ù„Ø³ÙˆÙ‚ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ Ù…Ù† Ø®Ø§Ù„ ØªÙˆØ­ÙŠØ¯ Ø¨Ø§Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø© Ù„Ù„Ù…Ø³ØªØ«Ù…Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø­Ø¯Ø« Ø§Ù„Ø£Ø³Ø§Ù„ÙŠØ¨ ÙˆØ§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ© ÙˆÙÙ‚Ù‹Ø§ Ù„Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„ØªÙ†Ù…ÙŠØ© Ø§Ù„Ù…Ø³ØªØ¯Ø§Ù…Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ© ÙˆÙ†Ø´Ø± Ø§Ù„ÙˆØ¹ÙŠ Ø¨Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ© ÙˆØ£Ù‡Ù…ÙŠØªÙ‡Ø§ ÙˆØ²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¥Ù†ØªØ§Ø¬ Ù…Ø¹ Ø§Ù„ØªÙ…Ø³Ùƒ Ø¨Ø¹Ù‚ÙŠØ¯Ø© Ø¹Ù…Ù„ Ù…Ø¤Ø³Ø³Ø© ÙˆØ§Ù„Ù†Ù‡ÙˆØ¶ Ø¨Ø£Ø¹Ø¶Ø§Ø¦Ù‡Ø§ ÙˆÙ…Ø³ØªØ«Ù…Ø±ÙŠÙ‡Ø§.",
                        "link": "https://www.omalmisr.com/about"
                    },
                    "Ø£Ù‡Ø¯Ø§ÙÙ†Ø§": {
                        "title": "Ø§Ù‡Ø¯Ø§ÙÙ†Ø§",
                        "description": "ØªÙˆØ­ÙŠØ¯ Ø¨Ø§Ø¨ Ø§Ù„Ø®Ø¯Ù…Ø© Ù„Ù„Ù…Ø³ØªØ«Ù…Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ. Ø£Ù† Ù†ÙƒÙˆÙ† Ø§Ù„Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø±Ø§Ø¦Ø¯Ø© Ù„Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ† Ø§Ù„ØµÙ†Ø§Ø¹ÙŠÙŠÙ† ÙˆØ§Ù„ÙƒÙˆØ§Ø¯Ø± Ø§Ù„Ø¨Ø´Ø±ÙŠØ© Ù„Ø¯Ø®ÙˆÙ„Ù‡Ù… Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ. Ø£Ù† Ù†ØµØ¨Ø­ Ù…Ù†Ø¸ÙˆÙ…Ø© Ø¥Ù‚ØªØµØ§Ø¯ÙŠØ© ØªØ¤Ø«Ø± ÙÙŠ Ø³ÙˆÙ‚ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ.",
                        "link": "https://www.omalmisr.com/about"
                    }
                }
            },
            "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§": {
                "title": "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
                "description": "ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±",
                "link": "https://www.omalmisr.com/contact",
                "submenu": {
                    "Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§": {
                        "title": "ØªØ§Ø¨Ø¹Ù†Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§",
                        "description": "ØªØ§Ø¨Ø¹ ØµÙØ­Ø§ØªÙ†Ø§ Ø¹Ù„Ù‰ Ù…Ù†ØµØ§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ",
                        "links": {
                            "ÙŠÙˆØªÙŠÙˆØ¨": "https://www.youtube.com/channel/UCAkYTIf30ypaEE5gfrMhdUw",
                            "Ø§Ù†Ø³ØªØºØ±Ø§Ù…": "https://www.instagram.com/omalmisr/",
                            "Ù„ÙŠÙ†ÙƒØ¯ Ø¥Ù†": "https://www.linkedin.com/company/79479037/admin/feed/posts/",
                            "ØªÙˆÙŠØªØ±": "https://twitter.com/omalmisr1",
                            "ÙÙŠØ³Ø¨ÙˆÙƒ": "https://www.facebook.com/Omal.Misr.Foundation/"
                        }
                    }
                }
            }
        }
        
        logger.info(f"ØªÙ… ØªÙ‡ÙŠØ¦Ø© ChatBot Ø¨Ù†Ø¬Ø§Ø­. Ø§Ø³Ù… Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª: {self.bot_name}ØŒ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {self.data_file}")
    
    def load_data(self) -> None:
        """
        ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù…Ù„Ù JSON
        """
        try:
            with open(self.data_file, 'r', encoding='utf-8') as f:
                data = json.load(f)
                self.prompts = data.get("prompts", [])
                self.human_expressions = data.get("human_expressions", {})
                self.contact_info = data.get("contact_info", {})
                self.requires_human_contact = data.get("requires_human_contact", [])
                self.user_categories = data.get("user_categories", [])
                self.job_sectors = data.get("job_sectors", [])
                self.personalize_response = data.get("personalize_response", self.personalize_response)
                
                # ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·
                self.service_links = data.get("service_links", {})
                self.service_categories = data.get("service_categories", {})
                
            logger.info(f"ØªÙ… ØªØ­Ù…ÙŠÙ„ {len(self.prompts)} Ø³Ø¤Ø§Ù„ ÙˆØ¬ÙˆØ§Ø¨ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
            
            if self.human_expressions:
                logger.info(f"ØªÙ… ØªØ­Ù…ÙŠÙ„ ØªØ¹Ø¨ÙŠØ±Ø§Øª Ø¨Ø´Ø±ÙŠØ© Ù„Ù€ {len(self.human_expressions)} ÙØ¦Ø© Ù…Ø®ØªÙ„ÙØ©")
            
            if self.user_categories:
                logger.info(f"ØªÙ… ØªØ­Ù…ÙŠÙ„ {len(self.user_categories)} ÙØ¦Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†")
            
            if self.service_links:
                logger.info(f"ØªÙ… ØªØ­Ù…ÙŠÙ„ {len(self.service_links)} Ø±Ø§Ø¨Ø· Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ø¬Ù…Ø¹")
            
        except FileNotFoundError:
            error_msg = f"Ø®Ø·Ø£: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª '{self.data_file}'"
            logger.error(error_msg)
            print(error_msg)
        except json.JSONDecodeError:
            error_msg = f"Ø®Ø·Ø£: Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª '{self.data_file}' Ù„ÙŠØ³ Ø¨ØµÙŠØºØ© JSON ØµØ§Ù„Ø­Ø©"
            logger.error(error_msg)
            print(error_msg)
        except Exception as e:
            error_msg = f"Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {e}"
            logger.error(error_msg)
            print(error_msg)
    
    def set_conversation_source(self, source: str) -> None:
        """
        ØªØ¹ÙŠÙŠÙ† Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© (Ù…Ø§Ø³Ù†Ø¬Ø± Ø£Ùˆ ØªØ¹Ù„ÙŠÙ‚ ÙÙŠØ³Ø¨ÙˆÙƒ)
        
        :param source: Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ("messenger" Ø£Ùˆ "facebook_comment")
        """
        if source in ["messenger", "facebook_comment"]:
            self.conversation_source = source
            logger.debug(f"ØªÙ… ØªØ¹ÙŠÙŠÙ† Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©: {source}")
        else:
            logger.warning(f"Ù…ØµØ¯Ø± Ù…Ø­Ø§Ø¯Ø«Ø© ØºÙŠØ± ØµØ§Ù„Ø­: {source}. Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: messenger")
            self.conversation_source = "messenger"

    def _get_random_expression(self, category: str) -> str:
        """
        Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ¹Ø¨ÙŠØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ù…Ù† ÙØ¦Ø© Ù…Ø¹ÙŠÙ†Ø©
        
        :param category: ÙØ¦Ø© Ø§Ù„ØªØ¹Ø¨ÙŠØ± (greetings, positive_responses, Ø¥Ù„Ø®)
        :return: ØªØ¹Ø¨ÙŠØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠ Ø£Ùˆ Ù†Øµ ÙØ§Ø±Øº Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„ÙØ¦Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©
        """
        expressions = self.human_expressions.get(category, [])
        
        if expressions and len(expressions) > 0:
            return random.choice(expressions)
        
        return ""

    def generate_menu_buttons(self, menu_type: str = "main", submenu_key: str = None) -> str:
        """
        ØªÙˆÙ„ÙŠØ¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù„Ø¹Ø±Ø¶Ù‡Ø§ ÙÙŠ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        
        :param menu_type: Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ("main" Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ø£Ùˆ "submenu" Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©)
        :param submenu_key: Ù…ÙØªØ§Ø­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (Ù…Ø«Ù„Ø§Ù‹ "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª")
        :return: Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
        """
        menu_text = "ğŸ” Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:\n\n"
        
        if menu_type == "main":
            # Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            for key, item in self.main_menu.items():
                menu_text += f"â–«ï¸ {item['title']}\n"
                menu_text += f"  {item['description']}\n"
                menu_text += f"  {item['link']}\n\n"
            
            menu_text += "ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù† Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø£Ø¹Ù„Ø§Ù‡ Ø£Ùˆ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù†Ù‡Ø§ Ø¨Ø§Ù„ØªÙØµÙŠÙ„."
        
        elif menu_type == "submenu" and submenu_key and submenu_key in self.main_menu:
            menu_item = self.main_menu[submenu_key]
            if "submenu" in menu_item:
                menu_text = f"ğŸ” Ø®Ø¯Ù…Ø§Øª {menu_item['title']}:\n\n"
                for key, subitem in menu_item["submenu"].items():
                    menu_text += f"â–«ï¸ {subitem['title']}\n"
                    menu_text += f"  {subitem['description']}\n"
                    
                    if key == "Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§" and "links" in subitem:
                        menu_text += "  Ù…Ù†ØµØ§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ:\n"
                        for platform, link in subitem["links"].items():
                            menu_text += f"  - {platform}: {link}\n"
                    else:
                        menu_text += f"  {subitem['link']}\n"
                    
                    menu_text += "\n"
                
                menu_text += f"Ù„Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ Ø§ÙƒØªØ¨ 'Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©'."
        
        return menu_text
    
    def process_menu_request(self, user_message: str) -> Optional[str]:
        """
        Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        
        :param user_message: Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        :return: Ø±Ø¯ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø£Ùˆ None Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
        """
        user_message = user_message.strip().lower()
        
        # Ø·Ù„Ø¨ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        if user_message in ["Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©", "Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", "Ø§Ù„Ø®Ø¯Ù…Ø§Øª", "Ø®Ø¯Ù…Ø§Øª", "Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª", "Ù‚Ø§Ø¦Ù…Ø©", "menu", "services"]:
            return self.generate_menu_buttons(menu_type="main")
        
        # Ø·Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© ÙØ±Ø¹ÙŠØ©
        for key, item in self.main_menu.items():
            if user_message in [key.lower(), item["title"].lower()]:
                if "submenu" in item:
                    return self.generate_menu_buttons(menu_type="submenu", submenu_key=key)
                else:
                    service_info = f"ğŸ“‹ {item['title']}\n\n{item['description']}\n\nğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·: {item['link']}"
                    return service_info
        
        # Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙØ±Ø¹ÙŠØ©
        for main_key, main_item in self.main_menu.items():
            if "submenu" in main_item:
                for sub_key, sub_item in main_item["submenu"].items():
                    if user_message in [sub_key.lower(), sub_item["title"].lower()]:
                        service_info = f"ğŸ“‹ {sub_item['title']}\n\n{sub_item['description']}\n\nğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·: {sub_item['link']}"
                        return service_info
        
        # Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ©
        keywords_map = {
            "ÙˆØ¸Ø§Ø¦Ù": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„",
            "ØªÙˆØ¸ÙŠÙ": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„",
            "Ø¹Ù…Ù„": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„",
            "ÙˆØ¸ÙŠÙØ©": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„",
            "ÙØ±ØµØ© Ø¹Ù…Ù„": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„",
            "Ø¨Ø§Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„",
            "Ø³ÙŠØ±Ø© Ø°Ø§ØªÙŠØ©": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„",
            
            "Ù…ÙˆØ¸ÙÙŠÙ†": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ¹Ù…Ø§Ù„",
            "Ø¹Ù…Ø§Ù„": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ¹Ù…Ø§Ù„",
            "Ø¹Ù…Ø§Ù„Ø©": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ¹Ù…Ø§Ù„",
            "ØªÙˆÙÙŠØ± Ø¹Ù…Ø§Ù„": "Ø£Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ¹Ù…Ø§Ù„",
            
            "Ø´Ø±ÙƒØ§Øª": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
            "Ø§Ø³ØªØ«Ù…Ø§Ø±": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
            "ÙØ±Øµ Ø§Ø³ØªØ«Ù…Ø§Ø±ÙŠØ©": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
            "Ø¬Ø¯ÙˆÙ‰": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
            "Ù…Ù†ØªØ¬Ø§Øª": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
            "Ø®Ø§Ù…Ø§Øª": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
            "ØªØ³ÙˆÙŠÙ‚": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
            "Ù…Ø§Ù„ÙŠØ©": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
            "Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
            "ØªØ¹Ù„ÙŠÙ…": "Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª",
            
            "Ù†Ø²Ø§Ø¹": "Ø¨ÙˆØ§Ø¨Ø© ÙØ¶ Ø§Ù„Ù…Ù†Ø§Ø²Ø¹Ø§Øª",
            "Ù…Ù†Ø§Ø²Ø¹Ø§Øª": "Ø¨ÙˆØ§Ø¨Ø© ÙØ¶ Ø§Ù„Ù…Ù†Ø§Ø²Ø¹Ø§Øª",
            "Ù…Ø´ÙƒÙ„Ø©": "Ø¨ÙˆØ§Ø¨Ø© ÙØ¶ Ø§Ù„Ù…Ù†Ø§Ø²Ø¹Ø§Øª",
            "ØªØ³ÙˆÙŠØ©": "Ø¨ÙˆØ§Ø¨Ø© ÙØ¶ Ø§Ù„Ù…Ù†Ø§Ø²Ø¹Ø§Øª",
            "Ø´ÙƒÙˆÙ‰": "Ø¨ÙˆØ§Ø¨Ø© ÙØ¶ Ø§Ù„Ù…Ù†Ø§Ø²Ø¹Ø§Øª",
            
            "ØªÙˆØ§ØµÙ„": "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
            "Ø§ØªØµÙ„": "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
            "Ù‡Ø§ØªÙ": "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
            "Ø¹Ù†ÙˆØ§Ù†": "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
            "Ø³ÙˆØ´ÙŠØ§Ù„": "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
            "ÙÙŠØ³Ø¨ÙˆÙƒ": "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
            "ÙŠÙˆØªÙŠÙˆØ¨": "ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§",
            
            "Ù…Ø¹Ù„ÙˆÙ…Ø§Øª": "Ù…Ù† Ù†Ø­Ù†",
            "Ù…Ù† Ù‡Ù…": "Ù…Ù† Ù†Ø­Ù†",
            "Ø±Ø¤ÙŠØ©": "Ù…Ù† Ù†Ø­Ù†",
            "Ø±Ø³Ø§Ù„Ø©": "Ù…Ù† Ù†Ø­Ù†",
            "Ù‡Ø¯Ù": "Ù…Ù† Ù†Ø­Ù†",
            "Ø£Ù‡Ø¯Ø§Ù": "Ù…Ù† Ù†Ø­Ù†"
        }
        
        # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        for keyword, menu_key in keywords_map.items():
            if keyword in user_message:
                if menu_key in self.main_menu:
                    item = self.main_menu[menu_key]
                    if "submenu" in item:
                        return self.generate_menu_buttons(menu_type="submenu", submenu_key=menu_key)
                    else:
                        service_info = f"ğŸ“‹ {item['title']}\n\n{item['description']}\n\nğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·: {item['link']}"
                        return service_info
        
        # Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø©
        return None

    def generate_messenger_response(self, user_id: str, message: str) -> str:
        """
        ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ø¨Ø± Ù…Ø§Ø³Ù†Ø¬Ø± ÙÙŠØ³Ø¨ÙˆÙƒ
        
        :param user_id: Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        :param message: Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        :return: Ø§Ù„Ø±Ø¯ Ø§Ù„Ù…ÙˆÙ„Ø¯
        """
        self.set_conversation_source("messenger")
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ·Ù„Ø¨ Ø§Ù„ØªØ­Ø¯Ø« Ù…Ø¹ Ù…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        for keyword in self.customer_service_keywords:
            if keyword in message.lower():
                return self._generate_human_representative_response(user_id)
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        menu_response = self.process_menu_request(message)
        if menu_response:
            logger.info(f"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø§Ø¦Ù…Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id}")
            return menu_response
        
        # Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        conversation_history = self._get_user_conversation_history(user_id)
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        context = self._build_conversation_context(user_id, conversation_history)
        
        # ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… DeepSeek API
        try:
            response = self.api.generate_response(message, context=context)
            
            # ØªÙ†Ù‚ÙŠØ© Ø§Ù„Ø±Ø¯ Ù…Ù† Ø£ÙŠ Ø¥Ø´Ø§Ø±Ø§Øª Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            response = self._filter_ai_references(response)
            
            # Ø¥Ø¶Ø§ÙØ© Ø¹Ø¨Ø§Ø±Ø© Ø§Ø³ØªÙ…Ø±Ø§Ø±ÙŠØ© Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙØ¹Ù„Ø©
            if self.continue_conversation and random.random() < 0.7:  # 70% Ù…Ù† Ø§Ù„ÙˆÙ‚Øª
                response += f"\n\n{random.choice(self.continue_phrases)}"
            
            # ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            self._save_conversation(user_id, message, response)
            
            return response
            
        except Exception as e:
            error_msg = f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯: {str(e)}"
            logger.error(error_msg)
            
            # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø¯ Ø§Ø­ØªÙŠØ§Ø·ÙŠ
            fallback_response = """
Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹!

Ù„Ù„Ø£Ø³ÙØŒ Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: 01012345678 Ø£Ùˆ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: info@omalmisrservices.com ÙˆØ³ÙŠÙ‚ÙˆÙ… ÙØ±ÙŠÙ‚Ù†Ø§ Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª.

Ø³Ù†ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ù„ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª!

Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ØŸ
            """
            return fallback_response
    
    def generate_comment_response(self, comment_id: str, comment_text: str, user_id: str = None) -> str:
        """
        ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ù„ØªØ¹Ù„ÙŠÙ‚ Ø¹Ù„Ù‰ Ù…Ù†Ø´ÙˆØ± ÙÙŠØ³Ø¨ÙˆÙƒ
        
        :param comment_id: Ù…Ø¹Ø±Ù Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
        :param comment_text: Ù†Øµ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚
        :param user_id: Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        :return: Ø§Ù„Ø±Ø¯ Ø§Ù„Ù…ÙˆÙ„Ø¯
        """
        self.set_conversation_source("facebook_comment")
        
        # ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Øµ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ Ù„ÙŠØ³ Ø«Ù†Ø§Ø¡Ù‹ ÙÙ‚Ø·
        praise_expressions = [
            "Ø´ÙƒØ±Ø§", "Ø¬Ø²Ø§ÙƒÙ… Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±Ø§", "Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡", "Ø±Ø§Ø¦Ø¹", "ØªÙ…Ø§Ù…", "Ø¬Ù…ÙŠÙ„", "Ø§Ø­Ø³Ù†ØªÙ…", 
            "ØªØ³Ù„Ù…", "Ø¨Ø§Ø±Ùƒ Ø§Ù„Ù„Ù‡ ÙÙŠÙƒÙ…", "Ø¬Ø²Ø§ÙƒÙ… Ø§Ù„Ù„Ù‡", "thank", "thanks", "â¤"
        ]
        
        # ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ¹Ù„ÙŠÙ‚ Ù…Ø¬Ø±Ø¯ Ø«Ù†Ø§Ø¡ ÙˆÙ„Ø§ ÙŠØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ø±Ø¯
        if len(comment_text.strip().split()) <= 3:  # ØªØ¹Ù„ÙŠÙ‚ Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹
            is_praise_only = False
            for expr in praise_expressions:
                if expr in comment_text.lower():
                    is_praise_only = True
                    break
                    
            if is_praise_only:
                logger.info(f"ØªÙ… ØªØ¬Ø§Ù‡Ù„ ØªØ¹Ù„ÙŠÙ‚ Ø«Ù†Ø§Ø¡ Ù‚ØµÙŠØ±: {comment_text}")
                return "IGNORE_PRAISE_COMMENT"
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        menu_response = self.process_menu_request(comment_text)
        if menu_response:
            logger.info(f"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ¹Ù„ÙŠÙ‚ {comment_id}")
            return menu_response
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙŠØ§Ù‚ Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø­Ø¯ÙˆØ¯ Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ
        context = f"""Ø£Ù†Øª 'Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©'ØŒ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±. ØªÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ Ø¨Ø£Ø³Ù„ÙˆØ¨ ÙˆØ¯ÙˆØ¯ ÙˆØ§Ø­ØªØ±Ø§ÙÙŠ.
Ù…Ù‡Ù…ØªÙƒ Ù‡ÙŠ ÙÙ‡Ù… Ø§Ø³ØªÙØ³Ø§Ø± Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØªÙˆØ¬ÙŠÙ‡Ù‡ Ù„Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù…Ù† Ø®Ø¯Ù…Ø§Øª Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±.

Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©:
- Ù„Ø§ ØªØ°ÙƒØ± Ø£Ø¨Ø¯Ø§Ù‹ Ø£Ù†Ùƒ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŒ Ø¨Ù„ Ø§Ø¸Ù‡Ø± Ù†ÙØ³Ùƒ ÙƒÙ…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ØªØ±Ù.
- ÙƒÙ† Ù…Ø®ØªØµØ±Ø§Ù‹ ÙÙŠ Ø±Ø¯ÙˆØ¯Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (2-4 Ø£Ø³Ø·Ø± Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰).
- Ù‚Ø¯Ù… Ø±Ø§Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø±Ø¯.
- Ø´Ø¬Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø±Ø¯.
- ØªØ¹Ø§Ù…Ù„ Ø¨Ø£Ø³Ù„ÙˆØ¨ Ø±Ø³Ù…ÙŠ Ù„ÙƒÙ† ÙˆØ¯ÙˆØ¯ Ù…Ø¹ Ø§Ù„Ù…Ø³ØªÙØ³Ø±ÙŠÙ†.

Ø§Ø³ØªÙØ³Ø§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ ØªØ¹Ù„ÙŠÙ‚ Ø¹Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ: {comment_text}
"""
        
        # ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… DeepSeek API
        try:
            response = self.api.generate_response(comment_text, context=context)
            
            # ØªÙ†Ù‚ÙŠØ© Ø§Ù„Ø±Ø¯ Ù…Ù† Ø£ÙŠ Ø¥Ø´Ø§Ø±Ø§Øª Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
            response = self._filter_ai_references(response)
            
            # Ø§Ø®ØªØµØ§Ø± Ø§Ù„Ø±Ø¯ Ù„Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø­ØªÙ‰ Ù„Ø§ ÙŠÙƒÙˆÙ† Ø·ÙˆÙŠÙ„Ø§Ù‹
            if len(response.split()) > 80:  # Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ø¯ Ø·ÙˆÙŠÙ„Ø§Ù‹ Ø¬Ø¯Ø§Ù‹
                # Ù…Ø­Ø§ÙˆÙ„Ø© ØªÙ‚ØµÙŠØ± Ø§Ù„Ø±Ø¯ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· ÙˆØ§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©
                lines = response.split("\n")
                shortened_response = []
                link_found = False
                
                for line in lines:
                    if "http" in line and not link_found:
                        shortened_response.append(line)
                        link_found = True
                    elif len(shortened_response) < 4 and len(line.strip()) > 0:
                        shortened_response.append(line)
                
                # Ø¥Ø¶Ø§ÙØ© Ø¹Ø¨Ø§Ø±Ø© ØªØ´Ø¬ÙŠØ¹ ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
                shortened_response.append("\nÙ‡Ù„ Ù„Ø¯ÙŠÙƒ Ø£Ø³Ø¦Ù„Ø© Ø£Ø®Ø±Ù‰ØŸ")
                response = "\n".join(shortened_response)
            
            logger.info(f"ØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ù„ØªØ¹Ù„ÙŠÙ‚ {comment_id}: {response[:50]}...")
            return response
            
        except Exception as e:
            error_msg = f"Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ø¯ Ù„ØªØ¹Ù„ÙŠÙ‚ {comment_id}: {str(e)}"
            logger.error(error_msg)
            
            # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø±Ø¯ Ø§Ø­ØªÙŠØ§Ø·ÙŠ
            with open('facebook_responses.json', 'r', encoding='utf-8') as f:
                fallback_responses = json.load(f)
            
            default_response = """
Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹!

Ù„Ù„Ø£Ø³ÙØŒ Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: 01012345678 Ø£Ùˆ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: info@omalmisrservices.com ÙˆØ³ÙŠÙ‚ÙˆÙ… ÙØ±ÙŠÙ‚Ù†Ø§ Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª.

Ø³Ù†ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ù„ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ø¨Ø£Ø³Ø±Ø¹ ÙˆÙ‚Øª!

Ù‡Ù„ ØªØ±ØºØ¨ ÙÙŠ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ØŸ
            """
            
            # Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø±Ø¯ Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ù…Ù†Ø§Ø³Ø¨
            for response in fallback_responses:
                if response.get("comment_id") == "comment4":  # Ø±Ø¯ Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
                    return response.get("response", default_response)
            
            return default_response
    
    def _filter_ai_references(self, text: str) -> str:
        """
        ØªÙ†Ù‚ÙŠØ© Ø§Ù„Ù†Øµ Ù…Ù† Ø£ÙŠ Ø¥Ø´Ø§Ø±Ø§Øª Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
        
        :param text: Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø±Ø§Ø¯ ØªÙ†Ù‚ÙŠØªÙ‡
        :return: Ø§Ù„Ù†Øµ Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†Ù‚ÙŠØ©
        """
        ai_references = [
            "ÙƒÙ†Ù…ÙˆØ°Ø¬ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", "ÙƒØ°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", "ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
            "Ù†Ù…ÙˆØ°Ø¬ Ù„ØºÙˆÙŠ", "Ù†Ù…ÙˆØ°Ø¬ Ù„ØºØ© ÙƒØ¨ÙŠØ±", "Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", "deepseek", "deep seek",
            "ai assistant", "ai model", "language model", "gpt", "llm", "Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ",
            "artificial intelligence", "ai", "ØªÙ… ØªØ·ÙˆÙŠØ±ÙŠ", "as an ai", "ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ"
        ]
        
        # Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø¨ØªØ¹Ø¨ÙŠØ±Ø§Øª Ø¨Ø¯ÙŠÙ„Ø©
        replacements = {
            "ÙƒÙ†Ù…ÙˆØ°Ø¬ Ù„Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ": "ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "ÙƒØ°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ": "ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ": "ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "Ù†Ù…ÙˆØ°Ø¬ Ù„ØºÙˆÙŠ": "Ù…Ø³Ø§Ø¹Ø¯ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "Ù†Ù…ÙˆØ°Ø¬ Ù„ØºØ© ÙƒØ¨ÙŠØ±": "Ù…Ø³Ø§Ø¹Ø¯ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ": "Ù…Ø³Ø§Ø¹Ø¯ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "deepseek": "Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±",
            "deep seek": "Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±",
            "ai assistant": "Ù…Ø³Ø§Ø¹Ø¯ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "ai model": "Ù…Ø³Ø§Ø¹Ø¯ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "language model": "Ù…Ø³Ø§Ø¹Ø¯ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "gpt": "Ù…Ø³Ø§Ø¹Ø¯ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "llm": "Ù…Ø³Ø§Ø¹Ø¯ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ": "ÙØ±ÙŠÙ‚ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "artificial intelligence": "ÙØ±ÙŠÙ‚ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "ai": "Ù…Ø³Ø§Ø¹Ø¯",
            "ØªÙ… ØªØ·ÙˆÙŠØ±ÙŠ": "ØªÙ… ØªØ¯Ø±ÙŠØ¨ÙŠ",
            "as an ai": "ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡",
            "ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ": "ÙƒÙ…Ø³Ø§Ø¹Ø¯ Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡"
        }
        
        filtered_text = text
        for ref, replacement in replacements.items():
            filtered_text = re.sub(re.escape(ref), replacement, filtered_text, flags=re.IGNORECASE)
        
        # ØªÙ†Ù‚ÙŠØ© Ø§Ù„Ø¹Ø¨Ø§Ø±Ø§Øª Ø§Ù„ØªÙŠ ØªØ¨Ø¯Ø£ Ø¨Ù€ "Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯" Ø£Ùˆ "Ø£Ù†Ø§ Ù„Ø³Øª"
        statements_to_remove = [
            r"Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.*?\.",
            r"Ø£Ù†Ø§ Ù„Ø³Øª Ø¥Ù†Ø³Ø§Ù†Ù‹Ø§ Ø­Ù‚ÙŠÙ‚ÙŠÙ‹Ø§.*?\.",
            r"I'm an AI.*?\.",
            r"I am an AI.*?\.",
            r"As an AI.*?\.",
            r"ÙƒÙ†Ù…ÙˆØ°Ø¬ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ.*?\.",
        ]
        
        for statement in statements_to_remove:
            filtered_text = re.sub(statement, "", filtered_text, flags=re.IGNORECASE | re.DOTALL)
        
        return filtered_text.strip()
    
    def _build_conversation_context(self, user_id: str, conversation_history: List[Dict[str, str]]) -> str:
        """
        Ø¨Ù†Ø§Ø¡ Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        
        :param user_id: Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        :param conversation_history: ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        :return: Ù†Øµ Ø§Ù„Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø¨Ù†ÙŠ
        """
        # Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        user_name = self.conversation_state.get(user_id, {}).get('user_name', 'Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø²Ø§Ø¦Ø±')
        
        # Ø¨Ù†Ø§Ø¡ Ø³ÙŠØ§Ù‚ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        context = f"""Ø£Ù†Øª 'Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©'ØŒ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø±Ø³Ù…ÙŠ Ù„Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±. ØªØªØ­Ø¯Ø« Ù…Ø¹ {user_name} Ø¹Ù„Ù‰ Ù…Ø§Ø³Ù†Ø¬Ø± ÙÙŠØ³Ø¨ÙˆÙƒ.
Ù…Ù‡Ù…ØªÙƒ Ù‡ÙŠ ÙÙ‡Ù… Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙˆØªÙˆØ¬ÙŠÙ‡Ù‡ Ù„Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù…Ù† Ø®Ø¯Ù…Ø§Øª Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±.

Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…Ù‡Ù…Ø©:
- Ù„Ø§ ØªØ°ÙƒØ± Ø£Ø¨Ø¯Ø§Ù‹ Ø£Ù†Ùƒ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠØŒ Ø¨Ù„ Ø§Ø¸Ù‡Ø± Ù†ÙØ³Ùƒ ÙƒÙ…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡ Ù…Ø­ØªØ±Ù.
- ÙƒÙ† ÙˆØ¯ÙˆØ¯Ø§Ù‹ ÙˆÙ…Ù‡Ù†ÙŠØ§Ù‹ ÙÙŠ Ø±Ø¯ÙˆØ¯Ùƒ.
- Ø´Ø¬Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø§Ù‚ØªØ¶Ø§Ø¡.
- ØªØ¬Ù†Ø¨ Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø±Ø³Ù…ÙŠØ© Ø¬Ø¯Ø§Ù‹ØŒ Ø§ÙƒØªØ¨ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ Ù…Ø«Ù„ Ø´Ø®Øµ Ø­Ù‚ÙŠÙ‚ÙŠ.
- ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø·Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©.
- Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… Ù…ØµØ·Ù„Ø­Ø§Øª Ø£Ø¬Ù†Ø¨ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù„Ù‡Ø§ Ø¨Ø¯ÙŠÙ„ Ø¹Ø±Ø¨ÙŠ Ø´Ø§Ø¦Ø¹.

Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±:
1. Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ØªÙˆØ¸ÙŠÙ Ù„Ù„Ø¨Ø§Ø­Ø«ÙŠÙ† Ø¹Ù† Ø¹Ù…Ù„: https://omalmisrservices.com/ar/jobs
2. Ø¨ÙˆØ§Ø¨Ø© ØªÙˆÙÙŠØ± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ù„Ù„Ø´Ø±ÙƒØ§Øª: https://omalmisrservices.com/ar/workers
3. Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø³ØªØ«Ù…Ø±ÙŠÙ†: https://omalmisrservices.com/ar/companies
4. Ø¨ÙˆØ§Ø¨Ø© ÙØ¶ ÙˆØªØ³ÙˆÙŠØ© Ø§Ù„Ù…Ù†Ø§Ø²Ø¹Ø§Øª: https://omalmisrservices.com/ar/dispute

"""
        
        # Ø¥Ø¶Ø§ÙØ© ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        if conversation_history:
            context += "\nØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚:\n"
            for i, exchange in enumerate(conversation_history[-5:]):  # Ø¢Ø®Ø± 5 ØªØ¨Ø§Ø¯Ù„Ø§Øª ÙÙ‚Ø·
                context += f"Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {exchange.get('user_message', '')}\n"
                context += f"Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©: {exchange.get('bot_response', '')}\n"
        
        return context
    
    def _get_user_conversation_history(self, user_id: str) -> List[Dict[str, str]]:
        """
        Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ÙŠÙ†
        
        :param user_id: Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        :return: Ù‚Ø§Ø¦Ù…Ø© Ø¨Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        """
        return self.conversation_history.get(user_id, [])
    
    def _save_conversation(self, user_id: str, user_message: str, bot_response: str) -> None:
        """
        Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙÙŠ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
        
        :param user_id: Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        :param user_message: Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        :param bot_response: Ø±Ø¯ Ø§Ù„Ø¨ÙˆØª
        """
        if user_id not in self.conversation_history:
            self.conversation_history[user_id] = []
        
        # Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
        self.conversation_history[user_id].append({
            'timestamp': datetime.datetime.now().isoformat(),
            'user_message': user_message,
            'bot_response': bot_response,
            'source': self.conversation_source
        })
        
        # Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª ÙÙŠ Ù…Ù„Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…ÙØ¹Ù„
        if BOT_SETTINGS.get("SAVE_CONVERSATIONS", True):
            self._save_conversation_to_file(user_id)
    
    def _save_conversation_to_file(self, user_id: str) -> None:
        """
        Ø­ÙØ¸ Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ù…Ù„Ù JSON
        
        :param user_id: Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        """
        if not BOT_SETTINGS.get("SAVE_CONVERSATIONS", True):
            return
        
        try:
            # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
            conversations_dir = BOT_SETTINGS.get("CONVERSATIONS_DIR", "conversations")
            os.makedirs(conversations_dir, exist_ok=True)
            
            # Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            filename_prefix = "messenger_" if self.conversation_source == "messenger" else "facebook_comment_"
            current_time = datetime.datetime.now().strftime("%Y%m%d_%H%M%S")
            
            # Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ø®ØªØµØ§Ø± Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            user_id_short = user_id[-8:] if len(user_id) > 8 else user_id
            
            filename = f"{conversations_dir}/{filename_prefix}{user_id_short}_{current_time}.json"
            
            # ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø­ÙØ¸
            conversation_data = {
                'user_id': user_id,
                'source': self.conversation_source,
                'timestamp': datetime.datetime.now().isoformat(),
                'conversation': self.conversation_history[user_id]
            }
            
            # ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„ÙÙŠØ³Ø¨ÙˆÙƒ
            if self.conversation_source == "facebook_comment":
                conversation_data['platform'] = "facebook"
                conversation_data['type'] = "comment"
            
            # Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…Ù„Ù JSON
            with open(filename, 'w', encoding='utf-8') as f:
                json.dump(conversation_data, f, ensure_ascii=False, indent=2)
            
            logger.debug(f"ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙÙŠ Ø§Ù„Ù…Ù„Ù: {filename}")
            
        except Exception as e:
            logger.error(f"Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… {user_id}: {str(e)}")
    
    def _generate_human_representative_response(self, user_id: str) -> str:
        """
        ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯ Ù„Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ù…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ø¨Ø´Ø±ÙŠ
        
        :param user_id: Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        :return: Ø±Ø¯ Ø¨Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù…Ù…Ø«Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
        """
        # ØªÙƒÙˆÙŠÙ† Ù†Øµ Ø§Ù„Ø±Ø¯
        greeting = self._get_random_expression("greetings")
        if not greeting:
            greeting = "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ!"
        
        user_name = self.conversation_state.get(user_id, {}).get('user_name', 'Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø¹Ù…ÙŠÙ„')
        
        response = f"{greeting} {user_name},\n\n"
        response += "Ø³ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ùƒ Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø£Ø­Ø¯ Ù…Ù…Ø«Ù„ÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡.\n\n"
        
        rep_name = self.human_rep_contact_info.get("name", "Ù…Ø­Ù…Ø¯ Ø³Ù„Ø§Ù…Ø©")
        rep_title = self.human_rep_contact_info.get("title", "Ù…Ø¯ÙŠØ± Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ - Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±")
        
        response += f"Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ {rep_name}:\n"
        
        if "phone" in self.human_rep_contact_info:
            response += f"ğŸ“ Ù‡Ø§ØªÙ: {self.human_rep_contact_info['phone']}\n"
        
        if "email" in self.human_rep_contact_info:
            response += f"ğŸ“§ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: {self.human_rep_contact_info['email']}\n"
        
        if "whatsapp" in self.human_rep_contact_info:
            response += f"ğŸ“± ÙˆØ§ØªØ³Ø§Ø¨: {self.human_rep_contact_info['whatsapp']}\n"
        
        if "messenger" in self.human_rep_contact_info:
            response += f"ğŸ’¬ Ù…Ø§Ø³Ù†Ø¬Ø±: {self.human_rep_contact_info['messenger']}\n"
        
        response += f"\nØ³ÙŠÙ‚ÙˆÙ… {rep_name} ({rep_title}) Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†ØŒ Ø¹Ø§Ø¯Ø©Ù‹ Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ (9 ØµØ¨Ø§Ø­Ø§Ù‹ - 5 Ù…Ø³Ø§Ø¡Ù‹).\n\n"
        response += "Ù†Ø´ÙƒØ±Ùƒ Ø¹Ù„Ù‰ ØªÙˆØ§ØµÙ„Ùƒ Ù…Ø¹ Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±."
        
        return response

# ØªØ¹Ø±ÙŠÙ Ø¯Ø§Ù„Ø© Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª
def test_chatbot():
    """Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Øª Ø¨ÙˆØª ÙÙŠ ÙˆØ¶Ø¹ Ø³Ø·Ø± Ø§Ù„Ø£ÙˆØ§Ù…Ø±"""
    chatbot = ChatBot()
    print("Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø´Ø§Øª Ø¨ÙˆØª Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±!")
    print("Ø§ÙƒØªØ¨ 'Ø®Ø±ÙˆØ¬' Ù„Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©.")
    
    user_id = f"test_user_{datetime.datetime.now().strftime('%Y%m%d%H%M%S')}"
    
    while True:
        user_input = input("\nØ£Ù†Øª: ")
        if user_input.lower() in ["Ø®Ø±ÙˆØ¬", "exit", "quit"]:
            print("Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ø´Ø§Øª Ø¨ÙˆØª Ù…Ø¬Ù…Ø¹ Ø¹Ù…Ø§Ù„ Ù…ØµØ±. Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‚Ø§Ø¡!")
            break
        
        response = chatbot.generate_messenger_response(user_id, user_input)
        print(f"\n{chatbot.bot_name}: {response}")

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù†Ø¯ ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù Ù…Ø¨Ø§Ø´Ø±Ø©
if __name__ == "__main__":
    test_chatbot()